import os
import glob
import json
import pandas as pd

# This script collects the results of the benchmarks from the JSON files
# generated by the PDDL planner and writes them into CSV files.
# The JSON files are expected to be in the `raw_data/pddl` directory
# and the CSV files will be written to the `benchmarks` directory.

JSON_DIR   = "../raw_data/pddl"
OUTPUT_DIR = "../benchmarks/"

os.makedirs(OUTPUT_DIR, exist_ok=True)

benchmarks = [
    "Reaching Definitions",
    "Available Expressions",
    "Live Variable Analysis",
    "Type-State Analysis",
    "Concurrency Analysis",
    "Very Busy Expressions",
    "Interval Analysis",
    "Taint Analysis"
]

# prepare storage
rows_by_bm = {bm: [] for bm in benchmarks}

for fn in glob.glob(os.path.join(JSON_DIR, "*.json")):
    with open(fn) as f:
        data = json.load(f)

    goal = data.get("goal", "")
    plan = " ; ".join(data.get("plan_steps", []))

    for bm in benchmarks:
        entry    = data.get("benchmarks", {}).get(bm, {})
        question = entry.get("question", "").strip()
        answer   = entry.get("answer", "").strip()

        rows_by_bm[bm].append({
            "goal": goal,
            "plan": plan,
            "question": question,
            "answer": answer
        })

# write out one CSV per benchmark
for bm, rows in rows_by_bm.items():
    df        = pd.DataFrame(rows, columns=["goal", "plan", "question", "answer"])
    safe_name = bm.replace(" ", "_")
    out_fn    = os.path.join(OUTPUT_DIR, f"pddl_{safe_name}.csv")
    df.to_csv(out_fn, index=False)
    print(f"Wrote {out_fn}")